cmake_minimum_required(VERSION 3.25)
project(RealMQ C)

set(CMAKE_C_STANDARD 11)

# Find ZeroMQ
find_package(PkgConfig)

# Find and link ZeroMQ
pkg_check_modules(ZMQ REQUIRED libzmq)
include_directories(${ZMQ_INCLUDE_DIRS})

# Find and link CZMQ
pkg_check_modules(CZMQ "libczmq" REQUIRED)
include_directories(${CZMQ_INCLUDE_DIRS})

# Find and link JSON-C
find_package(PkgConfig)
pkg_check_modules(JSON-C REQUIRED json-c)
include_directories(${JSON-C_INCLUDE_DIRS})

# ZeroMQ, CZMQ, and JSON-C library paths
if (APPLE)
    # Homebrew installation, glob is needed because of different version numbers
    file(GLOB ZEROMQ_PATHS /opt/homebrew/Cellar/zeromq/*/lib)
    file(GLOB CZMQ_PATHS /opt/homebrew/Cellar/czmq/*/lib)
    file(GLOB JSON-C_PATHS /opt/homebrew/Cellar/json-c/*/lib)
    link_directories(${ZEROMQ_PATHS} ${CZMQ_PATHS} ${JSON-C_PATHS})
elseif (UNIX AND NOT APPLE)
    link_directories(${ZMQ_LIBRARY_DIRS} ${CZMQ_LIBRARY_DIRS} ${JSON-C_LIBRARY_DIRS})
endif ()

# Add your library
add_library(RealMQ src/realmq_msg.c src/realmq_protocol.c src/realmq.h)
target_link_libraries(RealMQ ${ZMQ_LIBRARIES} ${CZMQ_LIBRARIES} ${JSON-C_LIBRARIES})

# More executables

#NORM

# Aggiungi la directory contenente i file zmq_norm al percorso di inclusione
include_directories(zmq_norm)

# webserver
add_executable(webserver zmq_norm/realmq_webserver.c)

# client
add_executable(norm_client zmq_norm/client.c zmq_norm/zhelpers.h)
target_link_libraries(norm_client RealMQ)

# server
add_executable(norm_server zmq_norm/server.c zmq_norm/zhelpers.h)
target_link_libraries(norm_server RealMQ)

# ----------------------------------

# client
add_executable(realmq_client realmq_client.c)
target_link_libraries(realmq_client RealMQ)

# server
add_executable(realmq_server realmq_server.c)
target_link_libraries(realmq_server RealMQ)

# Tests
add_executable(publisher test/publisher.c)
target_link_libraries(publisher RealMQ)

add_executable(subscriber test/subscriber.c)
target_link_libraries(subscriber RealMQ)
